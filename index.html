<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>instaAfferre</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="shortcut icon" href="assets/logo.png" type="image/x-icon">

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#121212">

</head>

<body class="bg-gray-900 text-white flex items-center justify-center h-screen">

  <div class="bg-gray-800 p-8 rounded-2xl shadow-xl w-96">
    <h1 class="text-2xl mb-4 font-bold text-center">Baixar Reels</h1>

    <input id="url" class="w-full p-3 rounded bg-gray-700 border border-gray-600" placeholder="Cole o link do Reels">

    <button onclick="baixar()" class="mt-4 w-full bg-blue-600 hover:bg-blue-700 p-3 rounded-xl">
      Baixar
    </button>

    <div id="status" class="mt-4 text-center"></div>
  </div>

  <script>

    const btnDownload = document.querySelector("button");

    let inputUrl = document.getElementById("url");
    
    inputUrl.addEventListener("input", () => {
      if (inputUrl.value.length < 3) {
        btnDownload.disabled = true;
        btnDownload.classList.add("opacity-50");
      } else {
        btnDownload.disabled = false;
        btnDownload.classList.remove("opacity-50");
      }
    });
 

    async function baixar() {
      const url = document.getElementById("url").value;
      const status = document.getElementById("status");

      status.innerHTML = "Buscando vídeo...";

      const res = await fetch("https://instaafferre.onrender.com/api/download", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ url })
      });

      const data = await res.json();

      if (!data.videoUrl) {
        status.innerHTML = "Erro ao extrair vídeo.";
        return;
      }

      status.innerHTML = "Baixando...";

      // inicia download
      const a = document.createElement("a");
      a.href = data.videoUrl;
      a.download = "reels.mp4";
      a.click();

      status.innerHTML = "Download iniciado!";
    }
  </script>



  <!-- Cloudflare Web Analytics -->
  <script defer src='https://static.cloudflareinsights.com/beacon.min.js'
    data-cf-beacon='{"token": "9534df6763594dd5993930b75df6e5ac"}'></script>
    
    <!-- End Cloudflare Web Analytics -->

  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js")
        .then(() => console.log("SW registrado"))
        .catch(err => console.error("Erro ao registrar SW:", err));
    }
  </script>


</body>

</html>